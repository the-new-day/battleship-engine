# Battleship engine

Бэкенд для бота, способного играть в Морской бой: для создания полноценной игры достаточно реализовать клиентскую часть и обеспечить взаимодействие с бэкендом. Вся игровая логика реализована.

## Сборка
Для сборки необходим CMake и компилятор с поддержкой C++23. Собрать можно командой:
```bash
cmake -B ./build & cmake --build ./build
```

## Основная логика
Перед началом игры нужно её создать. Для этого нужно выбрать режим игры у бота. Существует 2 режима игры: *master* и *slave*. В первом случае бот выбирает размеры поля и количества кораблей (но выбирает всегда стандартные: 10x10, система 1x4 + 2x3 + 3x2 + 4x1). В случае, если выбран *slave*, вы обязаны задать размеры поля и количество кораблей (не может быть 0).

### Игровой процесс
После настройки игры (поле, корабли) можно начать игру. Если вы хотите начать новую игру с теми же настройками, вы можете остановить игру и снова начать.

Процесс игры максимально прост: вы просите бота назвать координаты следующего его выстрела, а затем сообщаете результат. Если хотите выстрелить сами, также сообщаете координаты выстрела, а бот возвращает результат (попал/ранен/убит).

Программа не следит за соблюдением правил игры (в частности, очерёдность выстрелов), эта функция отводится игроку.

### Стратегии
Вы можете выбрать стратегию, в которой будет играть бот. Всего их существует 3: *ordered*, *parity* и *probability*. Также можно выбрать стратегию *custom*, что позволит боту решать самому (на самом деле, стратегия тогда будет зависеть от размеров поля).

#### Ordered
Это самая простая стратегия. Бот будет просто стрелять по всем клеткам подряд, начиная с левой верхней и заканчивая правой нижней.

*Охотящаяся стратегия* - стратегия, в которой, если получилось попасть по противнику, бот будет стараться выбить весь корабль. Также в охотящайся стратегии запоминаются гарантированно пустые клетки для избежания выстрелов по ним.

Следующие две являются такими.

#### Parity
Это охотящаяся стратегия, которая в базовом режиме (не в "охоте") отличается от ordered только тем, что стреляет по клеткам с шагом 2. Таким образом увеличивается шанс быстрого подбития крупных кораблей.

#### Probability
Стратегия, основанная на ожидании появления корабля в конктерной клетке. После каждого выстрела ожидания пересчитываются, и выбирается самая вероятная клетка. Это самая "умная" стратегия.

## Взаимодействие
В базовом варианте взаимодействие осуществляется через стандартный ввод-вывод. Однако игровая логика не зависит от конкретной реализации клиента, поэтому возможно добавить любой другой тип взаимодействия.

Через консоль взаимодействие осуществляется с помощью команд:
| Команда                      | Ответ          | Описание |
| -------                      | -----          | --------                                    |
| exit                         |  ok            |   программа завершается                     |
| create [master, slave]       |  ok            |   создать игру в режиме master или slave соответственно       |
| start                        |  ok            |   старт игры                     |
| stop                         |  ok            |   остановка текущей партии       |
| set width  N                 |  ok/failed     |   установить ширину поля (N положительное, влезает в uint64_t)       |
| get width                    |  N             |   получить длину поля  (N положительное, влезает в uint64_t)      |
| set height N                 |  ok/failed     |   установить высоту поля (N положительное, влезает в uint64_t)        |
| get height                   |  N             |   получить высоту поля  (N положительное, влезает в uint64_t)      |
| set count [1, 2, 3, 4]  N    |  ok/failed     |   установить количество кораблей определенного типа (N положительное, влезает в uint64_t)        |
| get count [1, 2, 3, 4]       |  N             |   получить количество кораблей определенного типа (N положительное, влезает в uint64_t)        |
| set strategy [ordered, custom, parity, probability]|  ok            |   выбрать стратегию для игры        |
| shot X Y                     |  miss/hit/kill |   выстрел по кораблям бота в координатах (X, Y) (X, Y положительные, влезают в uint64_t)      | 
| shot                         |  X Y           |   вернуть координаты следующего выстрела бота, в ответе два числа через пробел  (X,Y положительные, влезают в uint64_t)       |
| set result [miss, hit, kill]                     |  ok        |   установить результат последнего выстрела бота       |
| finished                     |  yes/no        |   окончена ли текущая партия       |
| win                          |  yes/no        |   победил ли бот       |
| lose                         |  yes/no        |   проиграл ли бот       |
| dump PATH                    |  ok            |   сохранить размер поля и текущую расстановку кораблей бота в файл        |
| load PATH                    |  ok            |   загрузить размер поля и расстановку кораблей из файла      |
| ping                         |  pong          |   тестовая команда                          |


## Сохранение поля
Вы можете загрузить для бота собственное поле либо сохранить текущую расстановку кораблей в файл для возобновления игры. Для этого воспользуйтесь соответствующими командами.

Загрузка поля автоматически задаёт конфигурацию и устанавливает роль бота в master, поэтому без остановки игры изменить её нельзя.

Формат файла:
```
10 10
1 h 3 0
1 h 8 1
1 h 2 3
1 h 9 4
2 h 0 5
2 h 0 7
4 h 6 7
2 h 1 9
3 v 3 5
3 v 7 3
```
В первой строке: длина и ширина поля.
Остальные строки: размер корабля, тип расположения (h - горизонтально, v - вертикально), x и y координаты самой левой верхней точки корабля (от левого верхнего угла).

P. S. Конечно, смысл игры теряется, если вы знаете поле противника (бота). Но если не смотреть...

## Примечания
Во время написания этого проекта я не был знаком со многими фичами современного C++, например, с умными указателями. Так что в некоторых местах можно было бы написать лучше. Но пока не хочу.

На нашем курсе проводился турнир по Морскому бою среди всех студентов. Я занял [13 место из 57](https://docs.google.com/spreadsheets/d/1cczS6qZeuPLAA_t2Tx2bU086r6r0xfqchPo1ZK2ZJc4/edit?gid=2095339941#gid=2095339941).

* [Оригинальное задание](original_task.md)
